import {readSobazaar} from "../problems/sobazaar.problem";
import {fitnessScore} from "../fitness";
import {calcRecursive} from "../evaluate";

export const configsDenseSparse = [
  [`Dense-0`, `{"config":{"type":"nearestNeighbour","N":21},"output":{"dtoType":"matrix","fromEntity":"user","toEntity":"product"},"input":[{"config":{"type":"addVector"},"output":{"dtoType":"matrix","fromEntity":"user","toEntity":"user"},"input":[{"config":{"type":"addVector"},"output":{"dtoType":"matrix","fromEntity":"user","toEntity":"user"},"input":[{"config":{"type":"pearsonSimilarity"},"output":{"dtoType":"matrix","fromEntity":"user","toEntity":"user"},"input":[{"config":{"type":"scaleMatrix","scale":5},"output":{"dtoType":"matrix","fromEntity":"user","toEntity":"product"},"input":[{"config":{"type":"interaction(purchase:buy_clicked)"},"output":{"dtoType":"matrix","fromEntity":"user","toEntity":"product"},"input":[]}]}]},{"config":{"type":"popularity"},"output":{"dtoType":"vector","entity":"user","valueType":"number"},"input":[{"config":{"type":"pearsonSimilarity"},"output":{"dtoType":"matrix","fromEntity":"user","toEntity":"user"},"input":[{"config":{"type":"interaction(product_detail_clicked)"},"output":{"dtoType":"matrix","fromEntity":"user","toEntity":"product"},"input":[]}]}]}]},{"config":{"type":"popularity"},"output":{"dtoType":"vector","entity":"user","valueType":"number"},"input":[{"config":{"type":"sumMatrix"},"output":{"dtoType":"matrix","fromEntity":"user","toEntity":"user"},"input":[{"config":{"type":"pearsonSimilarity"},"output":{"dtoType":"matrix","fromEntity":"user","toEntity":"user"},"input":[{"config":{"type":"interaction(product_detail_clicked)"},"output":{"dtoType":"matrix","fromEntity":"user","toEntity":"product"},"input":[]}]},{"config":{"type":"pearsonSimilarity"},"output":{"dtoType":"matrix","fromEntity":"user","toEntity":"user"},"input":[{"config":{"type":"interaction(product_wanted)"},"output":{"dtoType":"matrix","fromEntity":"user","toEntity":"product"},"input":[]}]}]}]}]},{"config":{"type":"nearestNeighbour","N":9},"output":{"dtoType":"matrix","fromEntity":"user","toEntity":"product"},"input":[{"config":{"type":"pearsonSimilarity"},"output":{"dtoType":"matrix","fromEntity":"user","toEntity":"user"},"input":[{"config":{"type":"interaction(purchase:buy_clicked)"},"output":{"dtoType":"matrix","fromEntity":"user","toEntity":"product"},"input":[]}]},{"config":{"type":"nearestNeighbour","N":14},"output":{"dtoType":"matrix","fromEntity":"user","toEntity":"product"},"input":[{"config":{"type":"pearsonSimilarity"},"output":{"dtoType":"matrix","fromEntity":"user","toEntity":"user"},"input":[{"config":{"type":"interaction(product_detail_clicked)"},"output":{"dtoType":"matrix","fromEntity":"user","toEntity":"product"},"input":[]}]},{"config":{"type":"nearestNeighbour","N":12},"output":{"dtoType":"matrix","fromEntity":"user","toEntity":"product"},"input":[{"config":{"type":"pearsonSimilarity"},"output":{"dtoType":"matrix","fromEntity":"user","toEntity":"user"},"input":[{"config":{"type":"interaction(product_detail_clicked)"},"output":{"dtoType":"matrix","fromEntity":"user","toEntity":"product"},"input":[]}]},{"config":{"type":"scaleMatrix","scale":3},"output":{"dtoType":"matrix","fromEntity":"user","toEntity":"product"},"input":[{"config":{"type":"interaction(purchase:buy_clicked)"},"output":{"dtoType":"matrix","fromEntity":"user","toEntity":"product"},"input":[]}]}]}]}]}]}`, `MRR@10=0.0241`],
  [`Dense-1`, `{"config":{"type":"nearestNeighbour","N":29},"output":{"dtoType":"matrix","fromEntity":"user","toEntity":"product"},"input":[{"config":{"type":"sumMatrix"},"output":{"dtoType":"matrix","fromEntity":"user","toEntity":"user"},"input":[{"config":{"type":"pearsonSimilarity"},"output":{"dtoType":"matrix","fromEntity":"user","toEntity":"user"},"input":[{"config":{"type":"sumMatrix"},"output":{"dtoType":"matrix","fromEntity":"user","toEntity":"product"},"input":[{"config":{"type":"interaction(purchase:buy_clicked)"},"output":{"dtoType":"matrix","fromEntity":"user","toEntity":"product"},"input":[]},{"config":{"type":"interaction(content:interact:product_detail_viewed)"},"output":{"dtoType":"matrix","fromEntity":"user","toEntity":"product"},"input":[]}]}]},{"config":{"type":"sumMatrix"},"output":{"dtoType":"matrix","fromEntity":"user","toEntity":"user"},"input":[{"config":{"type":"pearsonSimilarity"},"output":{"dtoType":"matrix","fromEntity":"user","toEntity":"user"},"input":[{"config":{"type":"interaction(pixel-init)"},"output":{"dtoType":"matrix","fromEntity":"user","toEntity":"product"},"input":[]}]},{"config":{"type":"pearsonSimilarity"},"output":{"dtoType":"matrix","fromEntity":"user","toEntity":"user"},"input":[{"config":{"type":"interaction(pixel-init)"},"output":{"dtoType":"matrix","fromEntity":"user","toEntity":"product"},"input":[]}]}]}]},{"config":{"type":"addVector"},"output":{"dtoType":"matrix","fromEntity":"user","toEntity":"product"},"input":[{"config":{"type":"nearestNeighbour","N":18},"output":{"dtoType":"matrix","fromEntity":"user","toEntity":"product"},"input":[{"config":{"type":"scaleMatrix","scale":10},"output":{"dtoType":"matrix","fromEntity":"user","toEntity":"user"},"input":[{"config":{"type":"pearsonSimilarity"},"output":{"dtoType":"matrix","fromEntity":"user","toEntity":"user"},"input":[{"config":{"type":"interaction(purchase:buy_clicked)"},"output":{"dtoType":"matrix","fromEntity":"user","toEntity":"product"},"input":[]}]}]},{"config":{"type":"sumMatrix"},"output":{"dtoType":"matrix","fromEntity":"user","toEntity":"product"},"input":[{"config":{"type":"interaction(pixel-init)"},"output":{"dtoType":"matrix","fromEntity":"user","toEntity":"product"},"input":[]},{"config":{"type":"interaction(purchase:buy_clicked)"},"output":{"dtoType":"matrix","fromEntity":"user","toEntity":"product"},"input":[]}]}]},{"config":{"type":"popularity"},"output":{"dtoType":"vector","entity":"product","valueType":"number"},"input":[{"config":{"type":"interaction(product_detail_clicked)"},"output":{"dtoType":"matrix","fromEntity":"user","toEntity":"product"},"input":[]}]}]}]}`, `MRR@10=0.0248`],
  [`Sparse-0`, `{"config":{"type":"nearestNeighbour","N":5},"output":{"dtoType":"matrix","fromEntity":"user","toEntity":"product"},"input":[{"config":{"type":"addVector"},"output":{"dtoType":"matrix","fromEntity":"user","toEntity":"user"},"input":[{"config":{"type":"scaleMatrix","scale":0},"output":{"dtoType":"matrix","fromEntity":"user","toEntity":"user"},"input":[{"config":{"type":"pearsonSimilarity"},"output":{"dtoType":"matrix","fromEntity":"user","toEntity":"user"},"input":[{"config":{"type":"scaleMatrix","scale":2},"output":{"dtoType":"matrix","fromEntity":"user","toEntity":"product"},"input":[{"config":{"type":"interaction(product_wanted)"},"output":{"dtoType":"matrix","fromEntity":"user","toEntity":"product"},"input":[]}]}]}]},{"config":{"type":"popularity"},"output":{"dtoType":"vector","entity":"user","valueType":"number"},"input":[{"config":{"type":"transpose"},"output":{"dtoType":"matrix","fromEntity":"product","toEntity":"user"},"input":[{"config":{"type":"interaction(purchase:buy_clicked)"},"output":{"dtoType":"matrix","fromEntity":"user","toEntity":"product"},"input":[]}]}]}]},{"config":{"type":"addVector"},"output":{"dtoType":"matrix","fromEntity":"user","toEntity":"product"},"input":[{"config":{"type":"scaleMatrix","scale":6},"output":{"dtoType":"matrix","fromEntity":"user","toEntity":"product"},"input":[{"config":{"type":"transpose"},"output":{"dtoType":"matrix","fromEntity":"user","toEntity":"product"},"input":[{"config":{"type":"transpose"},"output":{"dtoType":"matrix","fromEntity":"product","toEntity":"user"},"input":[{"config":{"type":"interaction(purchase:buy_clicked)"},"output":{"dtoType":"matrix","fromEntity":"user","toEntity":"product"},"input":[]}]}]}]},{"config":{"type":"popularity"},"output":{"dtoType":"vector","entity":"product","valueType":"number"},"input":[{"config":{"type":"interaction(content:interact:product_wanted)"},"output":{"dtoType":"matrix","fromEntity":"user","toEntity":"product"},"input":[]}]}]}]}`, `MRR@10=0.0165`],
  [`Sparse-1`, `{"config":{"type":"sumMatrix"},"output":{"dtoType":"matrix","fromEntity":"user","toEntity":"product"},"input":[{"config":{"type":"interaction(pixel-init)"},"output":{"dtoType":"matrix","fromEntity":"user","toEntity":"product"},"input":[]},{"config":{"type":"nearestNeighbour","N":8},"output":{"dtoType":"matrix","fromEntity":"user","toEntity":"product"},"input":[{"config":{"type":"sumMatrix"},"output":{"dtoType":"matrix","fromEntity":"user","toEntity":"user"},"input":[{"config":{"type":"pearsonSimilarity"},"output":{"dtoType":"matrix","fromEntity":"user","toEntity":"user"},"input":[{"config":{"type":"scaleMatrix","scale":4},"output":{"dtoType":"matrix","fromEntity":"user","toEntity":"product"},"input":[{"config":{"type":"interaction(content:interact:product_clicked)"},"output":{"dtoType":"matrix","fromEntity":"user","toEntity":"product"},"input":[]}]}]},{"config":{"type":"pearsonSimilarity"},"output":{"dtoType":"matrix","fromEntity":"user","toEntity":"user"},"input":[{"config":{"type":"interaction(product_detail_clicked)"},"output":{"dtoType":"matrix","fromEntity":"user","toEntity":"product"},"input":[]}]}]},{"config":{"type":"interaction(purchase:buy_clicked)"},"output":{"dtoType":"matrix","fromEntity":"user","toEntity":"product"},"input":[]}]}]}`, `MRR@10=0.0168`],
]

const main = async () => {
  const denseProblem = await readSobazaar(undefined, undefined, undefined, "dense")
  const sparseProblem = await readSobazaar(undefined, undefined, undefined, "sparse")

  const configs = configsDenseSparse.map(([key, config, ...rest]) => [key, JSON.parse(config)])

  configs.forEach(([key, config]) => {
      const denseScore = fitnessScore(
        calcRecursive(config, denseProblem),
        denseProblem
      ).raw
      const sparseScore = fitnessScore(
        calcRecursive(config, sparseProblem),
        sparseProblem
      ).raw
      console.log(`${key}\nDense MRR@10: ${denseScore.mrr}\nSparse MRR@10: ${sparseScore.mrr}`)
    }
  )
}

main()